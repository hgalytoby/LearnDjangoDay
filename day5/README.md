# Day04

## 遷移
- 分兩步實現
	- 生成遷移文件
	- 執行遷移文件
- 遷移文件的生成
	- 根據 models 文件生成對應的遷移文件
	- 根據 models 和已有遷移文件差別生成新的遷移文件
- 執行遷移文件
	- 先去遷移紀錄查找，那些文件未遷移過
		- app_lael + 遷移文件名字
	- 執行未遷移的文件
	- 執行完畢，紀錄執行過的遷移文件
- 重新遷移
	- 刪除遷移文件
	- 刪除遷移文件產生的表
	- 刪除遷移紀錄
	

## 模型關係
- 1:1
	- 應用場景
		- 用於複雜表的拆分
		- 擴展新功能
	- Django 中 OntToOneField
		- 使用的時候，關係聲明還是有細微差別的 
	- 實現
		- 使用外件實現的
		- 對外鍵實現的
		- 對外鍵添加了唯一約束
	- 數據刪除
		- 級聯表
			- 主表
			- 從表
			- 誰聲明關係誰就是主表
			- 在開發中如何確認主從
				- 當系統遭遇不可避免的毀滅十，只能保留一張表，這個表就是你的主表。
		- 默認特性 (CASECADE)
			- 從表資料刪除，主表不受影響。
			- 主表資料刪除，從表資料直接刪除。
		- PROTECT 受保護
			- 開發中為了防止誤操作，通常會設置為此模式。
			- 主表如果存在級聯資料，刪除動作受保護，無法刪除。
			- 主表不存在級聯資料，可以刪除成功。
		- SET
			- SET_NULL
				- 允許為 NULL
			- SET_DEFAULT
				- 存在默認值
			- SET()
				- 指定
		- 級聯資料獲取
			- 主獲取從，隱性屬性，默認就是級聯模型的名字。
			- 從獲取，顯性屬性，就是屬性的名字。
			
- 1:M
	- ForeignKey
	- 主從獲取
		- 主獲取從，隱性屬性，級聯模型 \_set。
			- student_set Manager 的子類
				- all
				- filter
				- exclude
				- Manager 上能使用的函數都能使用
			- 從獲取主
				- 顯性屬性

- M:N
	- 實際上最複雜
	- 開發中很少直接使用多對多屬性，而是自己維護多對多的關係。
	- 產生表的時候會產生單獨的關係表
		- 關係表中儲存關聯表的主鍵，通過多個外鍵實現的。
		- 多個外鍵值不能同時相等。
	- 級聯資料獲取
		- 從獲取主
			- 使用屬性，屬性是一個 Manager子類。
		- 主獲取從
			- 隱性屬性
				- 也是 Mangager 子類
	- 級聯資料
		- add
		- remove
		- clear
		- set
	
- ManyRelatedManager
	- 函數中定義的類
	- 並且父類是一個參數
	- 動態創建
			
			
## 模型繼承
- Django 中模型支持繼承
- 默認繼承是會將通用字段放到附表中，特定字段放在自己的表中，中間使用外鍵鏈接
	- 關係行資料庫關係越複雜，效率越低，查詢越慢。
	- 父類表中也會儲存過多的資料。
- 使用元訊息來解決這個問題
	- 使模型抽象化。
	- 抽象的模型就不會在資料庫中產生映射。
	- 子模型映射出來的表直接包含父模型的字段。
	- 在 Model 的原信息中添加 
	```
		class Meta:
			abstract = True
	```

## 靜態資源
- 使用的時候注意配置資源位置
- STATICFILES_DIRS
- 使用 {% load static %}
- {% static '相對路徑' %}


##文件上傳
- 客戶端
	- 必須使用POST
	- 指定 enctype = 'multiplepart/form-data'
- 原生
	- 文件複製。
	- 從 request.FILES 中獲取道上傳上來的文件。
	- 打開一個文件，從上傳上來的文件進行讀取，像打開的文件中進行寫入。
	- 每次寫入記得 flush。
- Django 內置
	- ImageField
		- 依賴於 pillow
		- 配置使用
			- settings 中指定 MEDIA_ROOT
			- 指定字段的 upload_to
				- 相對於 MEDIA_ROOT 的路徑。
				- 支持時間格式化
					- %Y
					- %m
					- %d
					- %h
					- %...
					
					
## 在企業開發中
- model -> sql
	- 都可以使用
- sql -> model
	- django 也提供了很多的支持
	- Python manage.py inspectdb
		- Python manage.py inspectdb > models.py 自動建立模型。
		- 可以直接根據表生成模型，
		- 元訊息中包含一個屬性 managed=False
			- 如果自己的模型不想被遷移系統管理，也可以使用 managed=False。
			
			
## requests
- 請求庫
- 實際上是 urllib 封裝
	- Python 內置模塊
- 使用場景
	- 爬蟲
	- MCS 架構
		- 添加中間層伺服器
			
			
			
			
			